<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#9F42BC"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-04-16T17:42:21.70731667"><title>Docker Registry: Seu Reposit&oacute;rio Privado 📦 | Learn Docker</title><script type="application/json" id="virtual-toc-data">[{"id":"fundamentos-do-registry","level":0,"title":"Fundamentos do Registry 📚","anchor":"#fundamentos-do-registry"},{"id":"implanta-o-do-registry","level":0,"title":"Implantação do Registry 🚀","anchor":"#implanta-o-do-registry"},{"id":"opera-es-b-sicas","level":0,"title":"Operações Básicas 🛠️","anchor":"#opera-es-b-sicas"},{"id":"configura-o-avan-ada","level":0,"title":"Configuração Avançada ⚙️","anchor":"#configura-o-avan-ada"},{"id":"alta-disponibilidade","level":0,"title":"Alta Disponibilidade 🌟","anchor":"#alta-disponibilidade"},{"id":"seguran-a-e-pol-ticas","level":0,"title":"Segurança e Políticas 🔒","anchor":"#seguran-a-e-pol-ticas"},{"id":"monitoramento","level":0,"title":"Monitoramento 📊","anchor":"#monitoramento"},{"id":"troubleshooting","level":0,"title":"Troubleshooting 🔍","anchor":"#troubleshooting"},{"id":"registry-ui","level":0,"title":"Registry UI 🖥️","anchor":"#registry-ui"},{"id":"ci-cd-integration","level":0,"title":"CI/CD Integration 🔄","anchor":"#ci-cd-integration"},{"id":"waifu-registry-tips","level":0,"title":"Waifu Registry Tips 💫","anchor":"#waifu-registry-tips"},{"id":"checklist-de-produ-o","level":0,"title":"Checklist de Produção ✅","anchor":"#checklist-de-produ-o"},{"id":"recursos-adicionais","level":0,"title":"Recursos Adicionais 📚","anchor":"#recursos-adicionais"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="images/logo-primary.svg"><meta name="image" content="logo-primary.svg"><!-- Open Graph --><meta property="og:title" content="Docker Registry: Seu Reposit&oacute;rio Privado 📦 | Learn Docker"><meta property="og:description" content=""><meta property="og:image" content="logo-primary.svg"><meta property="og:site_name" content="Learn Docker Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/docker-registry.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="logo-primary.svg"><meta name="twitter:title" content="Docker Registry: Seu Reposit&oacute;rio Privado 📦 | Learn Docker"><meta name="twitter:description" content=""><meta name="twitter:creator" content="logo-primary.svg"><meta name="twitter:image:src" content="logo-primary.svg"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/docker-registry.html#webpage",
    "url": "writerside-documentation/docker-registry.html",
    "name": "Docker Registry: Seu Reposit&oacute;rio Privado 📦 | Learn Docker",
    "description": "",
    "image": "logo-primary.svg",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Learn Docker Help"
}</script><!-- End Schema.org --></head><body data-id="docker-registry" data-main-title="Docker Registry: Seu Repositório Privado 📦" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="INFRASTRUCTURE: System Design///Security"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Learn Docker  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="docker-registry" id="docker-registry.md">Docker Registry: Seu Repositório Privado 📦</h1><div class="code-block" data-lang="none">
╔═══════════════════════════════════════════════════════════╗
║  DOCKER REGISTRY: PRIVATE IMAGE REPOSITORY                ║
║                                                          ║
║  &quot;Seu próprio cantinho seguro para guardar imagens&quot;      ║
╚═══════════════════════════════════════════════════════════╝
</div><section class="chapter"><h2 id="fundamentos-do-registry" data-toc="fundamentos-do-registry">Fundamentos do Registry 📚</h2><section class="chapter"><h3 id="o-que-um-registry" data-toc="o-que-um-registry">O que &eacute; um Registry?</h3><ul class="list _bullet" id="-a9z9g3_19"><li class="list__item" id="-a9z9g3_20"><p id="-a9z9g3_24">Servi&ccedil;o de armazenamento e distribui&ccedil;&atilde;o</p></li><li class="list__item" id="-a9z9g3_21"><p id="-a9z9g3_25">Reposit&oacute;rio de imagens Docker</p></li><li class="list__item" id="-a9z9g3_22"><p id="-a9z9g3_26">Sistema de versionamento</p></li><li class="list__item" id="-a9z9g3_23"><p id="-a9z9g3_27">Controle de acesso</p></li></ul></section><section class="chapter"><h3 id="tipos-de-registry" data-toc="tipos-de-registry">Tipos de Registry</h3><ol class="list _decimal" id="-a9z9g3_28" type="1"><li class="list__item" id="-a9z9g3_29"><p id="-a9z9g3_32"><span class="control" id="-a9z9g3_33">Docker Hub</span> (P&uacute;blico)</p></li><li class="list__item" id="-a9z9g3_30"><p id="-a9z9g3_34"><span class="control" id="-a9z9g3_35">Registry Privado</span></p></li><li class="list__item" id="-a9z9g3_31"><p id="-a9z9g3_36"><span class="control" id="-a9z9g3_38">Cloud Providers</span></p><ul class="list _bullet" id="-a9z9g3_37"><li class="list__item" id="-a9z9g3_39"><p id="-a9z9g3_42">Amazon ECR</p></li><li class="list__item" id="-a9z9g3_40"><p id="-a9z9g3_43">Google Container Registry</p></li><li class="list__item" id="-a9z9g3_41"><p id="-a9z9g3_44">Azure Container Registry</p></li></ul></li></ol></section></section><section class="chapter"><h2 id="implanta-o-do-registry" data-toc="implanta-o-do-registry">Implanta&ccedil;&atilde;o do Registry 🚀</h2><section class="chapter"><h3 id="registry-local" data-toc="registry-local">Registry Local</h3><div class="code-block" data-lang="bash">
# Iniciar registry local
docker run -d \
  -p 5000:5000 \
  --name registry \
  registry:2

# Testar registry
curl http://localhost:5000/v2/_catalog
</div></section><section class="chapter"><h3 id="registry-com-tls" data-toc="registry-com-tls">Registry com TLS</h3><div class="code-block" data-lang="bash">
# Gerar certificados
openssl req -newkey rsa:4096 -nodes -sha256 \
  -keyout certs/domain.key -x509 -days 365 \
  -out certs/domain.crt

# Iniciar registry seguro
docker run -d \
  -p 5000:5000 \
  --name registry \
  -v $(pwd)/certs:/certs \
  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \
  -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \
  registry:2
</div></section></section><section class="chapter"><h2 id="opera-es-b-sicas" data-toc="opera-es-b-sicas">Opera&ccedil;&otilde;es B&aacute;sicas 🛠️</h2><section class="chapter"><h3 id="push-e-pull" data-toc="push-e-pull">Push e Pull</h3><div class="code-block" data-lang="bash">
# Tag local
docker tag nginx:latest localhost:5000/my-nginx

# Push para registry local
docker push localhost:5000/my-nginx

# Pull do registry local
docker pull localhost:5000/my-nginx
</div></section><section class="chapter"><h3 id="autentica-o" data-toc="autentica-o">Autentica&ccedil;&atilde;o</h3><div class="code-block" data-lang="bash">
# Configurar autenticação básica
docker run -d \
  -p 5000:5000 \
  --name registry \
  -v $(pwd)/auth:/auth \
  -e &quot;REGISTRY_AUTH=htpasswd&quot; \
  -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; \
  -e &quot;REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd&quot; \
  registry:2

# Login no registry
docker login localhost:5000
</div></section></section><section class="chapter"><h2 id="configura-o-avan-ada" data-toc="configura-o-avan-ada">Configura&ccedil;&atilde;o Avan&ccedil;ada ⚙️</h2><section class="chapter"><h3 id="storage-backends" data-toc="storage-backends">Storage Backends</h3><div class="code-block" data-lang="yaml">
storage:
  filesystem:
    rootdirectory: /var/lib/registry
  s3:
    accesskey: awsaccesskey
    secretkey: awssecretkey
    region: us-east-1
    bucket: docker-registry
</div></section><section class="chapter"><h3 id="garbage-collection" data-toc="garbage-collection">Garbage Collection</h3><div class="code-block" data-lang="bash">
# Executar garbage collection
docker exec registry bin/registry garbage-collect \
  /etc/docker/registry/config.yml
</div></section></section><section class="chapter"><h2 id="alta-disponibilidade" data-toc="alta-disponibilidade">Alta Disponibilidade 🌟</h2><section class="chapter"><h3 id="registry-em-cluster" data-toc="registry-em-cluster">Registry em Cluster</h3><div class="code-block" data-lang="yaml">
version: '3'
services:
  registry1:
    image: registry:2
    ports:
      - &quot;5000:5000&quot;
    environment:
      REGISTRY_HTTP_TLS_CERTIFICATE: /certs/domain.crt
      REGISTRY_HTTP_TLS_KEY: /certs/domain.key
    volumes:
      - registry-data:/var/lib/registry
      - ./certs:/certs
</div></section><section class="chapter"><h3 id="load-balancing" data-toc="load-balancing">Load Balancing</h3><div class="code-block" data-lang="nginx">
upstream docker-registry {
  server registry1:5000;
  server registry2:5000;
}

server {
  listen 443 ssl;
  server_name registry.example.com;

  ssl_certificate /etc/nginx/certs/domain.crt;
  ssl_certificate_key /etc/nginx/certs/domain.key;

  location / {
    proxy_pass http://docker-registry;
  }
}
</div></section></section><section class="chapter"><h2 id="seguran-a-e-pol-ticas" data-toc="seguran-a-e-pol-ticas">Seguran&ccedil;a e Pol&iacute;ticas 🔒</h2><section class="chapter"><h3 id="image-signing" data-toc="image-signing">Image Signing</h3><div class="code-block" data-lang="bash">
# Habilitar DCT (Docker Content Trust)
export DOCKER_CONTENT_TRUST=1

# Assinar imagem
docker trust sign myregistry.com/app:1.0
</div></section><section class="chapter"><h3 id="access-control" data-toc="access-control">Access Control</h3><div class="code-block" data-lang="yaml">
auth:
  token:
    realm: https://auth.example.com/token
    service: container_registry
    issuer: auth_token_issuer
</div></section></section><section class="chapter"><h2 id="monitoramento" data-toc="monitoramento">Monitoramento 📊</h2><section class="chapter"><h3 id="m-tricas-b-sicas" data-toc="m-tricas-b-sicas">M&eacute;tricas B&aacute;sicas</h3><div class="code-block" data-lang="bash">
# Verificar status
curl -X GET http://localhost:5000/debug/vars

# Monitorar espaço
du -sh /var/lib/registry
</div></section><section class="chapter"><h3 id="prometheus-integration" data-toc="prometheus-integration">Prometheus Integration</h3><div class="code-block" data-lang="yaml">
metrics:
  enabled: true
  address: localhost:5001
</div></section></section><section class="chapter"><h2 id="troubleshooting" data-toc="troubleshooting">Troubleshooting 🔍</h2><section class="chapter"><h3 id="logs-e-debug" data-toc="logs-e-debug">Logs e Debug</h3><div class="code-block" data-lang="bash">
# Verificar logs
docker logs registry

# Aumentar verbosidade
docker run -d \
  -e REGISTRY_LOG_LEVEL=debug \
  registry:2
</div></section><section class="chapter"><h3 id="problemas-comuns" data-toc="problemas-comuns">Problemas Comuns</h3><ol class="list _decimal" id="-a9z9g3_72" type="1"><li class="list__item" id="-a9z9g3_73"><p id="-a9z9g3_75"><span class="control" id="-a9z9g3_77">Certificados Inv&aacute;lidos</span></p><div class="code-block" data-lang="bash">
# Adicionar certificado ao sistema
cp domain.crt /usr/local/share/ca-certificates/
update-ca-certificates
</div></li><li class="list__item" id="-a9z9g3_74"><p id="-a9z9g3_78"><span class="control" id="-a9z9g3_80">Problemas de Storage</span></p><div class="code-block" data-lang="bash">
# Verificar permissões
chown -R 100:100 /var/lib/registry
</div></li></ol></section></section><section class="chapter"><h2 id="registry-ui" data-toc="registry-ui">Registry UI 🖥️</h2><section class="chapter"><h3 id="docker-registry-ui" data-toc="docker-registry-ui">Docker Registry UI</h3><div class="code-block" data-lang="bash">
# Iniciar interface web
docker run -d \
  -p 8080:8080 \
  --name registry-ui \
  -e REGISTRY_URL=http://registry:5000 \
  joxit/docker-registry-ui
</div></section></section><section class="chapter"><h2 id="ci-cd-integration" data-toc="ci-cd-integration">CI/CD Integration 🔄</h2><section class="chapter"><h3 id="github-actions" data-toc="github-actions">GitHub Actions</h3><div class="code-block" data-lang="yaml">
jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Login to Registry
        run: docker login -u ${{ secrets.REGISTRY_USER }} -p ${{ secrets.REGISTRY_PASS }}
        
      - name: Build and Push
        run: |
          docker build -t registry.example.com/app:${{ github.sha }} .
          docker push registry.example.com/app:${{ github.sha }}
</div></section></section><section class="chapter"><h2 id="waifu-registry-tips" data-toc="waifu-registry-tips">Waifu Registry Tips 💫</h2><aside class="prompt" data-type="tip" data-title="" id="-a9z9g3_85"><p id="-a9z9g3_87"><span class="control" id="-a9z9g3_88">Registry-chan diz:</span> &quot;Mantenha suas imagens organizadas como uma cole&ccedil;&atilde;o de mang&aacute;s!&quot;</p></aside><aside class="prompt" data-type="warning" data-title="" id="-a9z9g3_86"><p id="-a9z9g3_89"><span class="control" id="-a9z9g3_90">Storage-sama alerta:</span> &quot;N&atilde;o se esque&ccedil;a do garbage collection, ou seu espa&ccedil;o vai sumir mais r&aacute;pido que um pocky!&quot;</p></aside></section><section class="chapter"><h2 id="checklist-de-produ-o" data-toc="checklist-de-produ-o">Checklist de Produ&ccedil;&atilde;o ✅</h2><ol class="list _decimal" id="-a9z9g3_91" type="1"><li class="list__item" id="-a9z9g3_92"><p id="-a9z9g3_99">[x] TLS configurado</p></li><li class="list__item" id="-a9z9g3_93"><p id="-a9z9g3_100">[x] Autentica&ccedil;&atilde;o habilitada</p></li><li class="list__item" id="-a9z9g3_94"><p id="-a9z9g3_101">[x] Storage backend redundante</p></li><li class="list__item" id="-a9z9g3_95"><p id="-a9z9g3_102">[x] Monitoramento ativo</p></li><li class="list__item" id="-a9z9g3_96"><p id="-a9z9g3_103">[x] Backup automatizado</p></li><li class="list__item" id="-a9z9g3_97"><p id="-a9z9g3_104">[x] Pol&iacute;ticas de reten&ccedil;&atilde;o</p></li><li class="list__item" id="-a9z9g3_98"><p id="-a9z9g3_105">[x] Rate limiting configurado</p></li></ol></section><section class="chapter"><h2 id="recursos-adicionais" data-toc="recursos-adicionais">Recursos Adicionais 📚</h2><section class="chapter"><h3 id="documenta-o" data-toc="documenta-o">Documenta&ccedil;&atilde;o</h3><ul class="list _bullet" id="-a9z9g3_108"><li class="list__item" id="-a9z9g3_109"><p id="-a9z9g3_112"><a href="https://docs.docker.com/registry/" id="-a9z9g3_113" data-external="true" rel="noopener noreferrer" target="_blank">Docker Registry</a></p></li><li class="list__item" id="-a9z9g3_110"><p id="-a9z9g3_114"><a href="https://github.com/distribution/distribution" id="-a9z9g3_115" data-external="true" rel="noopener noreferrer" target="_blank">Distribution</a></p></li><li class="list__item" id="-a9z9g3_111"><p id="-a9z9g3_116"><a href="https://docs.docker.com/registry/configuration/" id="-a9z9g3_117" data-external="true" rel="noopener noreferrer" target="_blank">Registry Configuration</a></p></li></ul></section><section class="chapter"><h3 id="ferramentas" data-toc="ferramentas">Ferramentas</h3><ul class="list _bullet" id="-a9z9g3_118"><li class="list__item" id="-a9z9g3_120"><p id="-a9z9g3_123"><a href="https://github.com/Joxit/docker-registry-ui" id="-a9z9g3_124" data-external="true" rel="noopener noreferrer" target="_blank">Registry UI</a></p></li><li class="list__item" id="-a9z9g3_121"><p id="-a9z9g3_125"><a href="https://github.com/genuinetools/reg" id="-a9z9g3_126" data-external="true" rel="noopener noreferrer" target="_blank">Registry CLI</a></p></li><li class="list__item" id="-a9z9g3_122"><p id="-a9z9g3_127"><a href="https://github.com/distribution/distribution/tree/main/cmd/registry" id="-a9z9g3_128" data-external="true" rel="noopener noreferrer" target="_blank">Distribution Tools</a></p></li></ul><aside class="prompt" data-type="note" data-title="" id="-a9z9g3_119"><p id="-a9z9g3_129"><span class="control" id="-a9z9g3_130">Registry Master's Note:</span> &quot;Um registry bem configurado &eacute; como um bonsai - requer cuidado constante e podas regulares.&quot;</p></aside></section></section><div class="last-modified">16 abril 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="docker-security.html" class="navigation-links__prev">Docker Security: Prote&ccedil;&atilde;o em Camadas 🔒</a><a href="docker-performance.html" class="navigation-links__next">Docker Performance Optimization 🚀</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>